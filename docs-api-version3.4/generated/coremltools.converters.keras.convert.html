

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>coremltools.converters.keras.convert &mdash; coremltools 3.2 documentation</title>
  

  
  
  
  

  
  <script type="text/javascript" src="../static/js/modernizr.min.js"></script>
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="../" src="../static/documentation_options.js"></script>
        <script type="text/javascript" src="../static/jquery.js"></script>
        <script type="text/javascript" src="../static/underscore.js"></script>
        <script type="text/javascript" src="../static/doctools.js"></script>
        <script type="text/javascript" src="../static/language_data.js"></script>
        <script async="async" type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/latest.js?config=TeX-AMS-MML_HTMLorMML"></script>
    
    <script type="text/javascript" src="../static/js/theme.js"></script>

    

  
  <link rel="stylesheet" href="../static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../static/pygments.css" type="text/css" />
  <link rel="stylesheet" href="../static/graphviz.css" type="text/css" />
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="coremltools.converters.caffe.convert" href="coremltools.converters.caffe.convert.html" />
    <link rel="prev" title="coremltools.converters.tensorflow.convert" href="coremltools.converters.tensorflow.convert.html" />
    <link href="../static/style.css" rel="stylesheet" type="text/css">

</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search"  style="background: #007AFF" >
          

          
            <a href="../index.html" class="icon icon-home"> coremltools
          

          
          </a>

          
            
            
              <div class="version">
                3.2
              </div>
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <ul class="current">
<li class="toctree-l1 current"><a class="reference internal" href="../coremltools.converters.html">Converters</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="coremltools.converters.tensorflow.convert.html">coremltools.converters.tensorflow.convert</a></li>
<li class="toctree-l2 current"><a class="current reference internal" href="#">coremltools.converters.keras.convert</a></li>
<li class="toctree-l2"><a class="reference internal" href="coremltools.converters.caffe.convert.html">coremltools.converters.caffe.convert</a></li>
<li class="toctree-l2"><a class="reference internal" href="coremltools.converters.libsvm.convert.html">coremltools.converters.libsvm.convert</a></li>
<li class="toctree-l2"><a class="reference internal" href="coremltools.converters.sklearn.convert.html">coremltools.converters.sklearn.convert</a></li>
<li class="toctree-l2"><a class="reference internal" href="coremltools.converters.xgboost.convert.html">coremltools.converters.xgboost.convert</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../coremltools.models.html">Models</a><ul>
<li class="toctree-l2"><a class="reference internal" href="coremltools.models.MLModel.html">coremltools.models.MLModel</a></li>
<li class="toctree-l2"><a class="reference internal" href="coremltools.models.pipeline.html">coremltools.models.pipeline</a></li>
<li class="toctree-l2"><a class="reference internal" href="coremltools.models.tree_ensemble.html">coremltools.models.tree_ensemble</a></li>
<li class="toctree-l2"><a class="reference internal" href="coremltools.models.nearest_neighbors.builder.html">coremltools.models.nearest_neighbors.builder</a></li>
<li class="toctree-l2"><a class="reference internal" href="coremltools.models.neural_network.builder.html">coremltools.models.neural_network.builder</a></li>
<li class="toctree-l2"><a class="reference internal" href="coremltools.models.neural_network.flexible_shape_utils.html">coremltools.models.neural_network.flexible_shape_utils</a></li>
<li class="toctree-l2"><a class="reference internal" href="coremltools.models.neural_network.quantization_utils.html">coremltools.models.neural_network.quantization_utils</a></li>
<li class="toctree-l2"><a class="reference internal" href="coremltools.models.neural_network.update_optimizer_utils.html">coremltools.models.neural_network.update_optimizer_utils</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../coremltools.utils.html">Utilities</a><ul class="simple">
</ul>
</li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">coremltools</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content style-external-links">
        
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../index.html">Docs</a> &raquo;</li>
        
          <li><a href="../coremltools.converters.html">Converters</a> &raquo;</li>
        
      <li>coremltools.converters.keras.convert</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
            
            <a href="../sources/generated/coremltools.converters.keras.convert.rst.txt" rel="nofollow"> View page source</a>
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="coremltools-converters-keras-convert">
<h1>coremltools.converters.keras.convert<a class="headerlink" href="#coremltools-converters-keras-convert" title="Permalink to this headline">¶</a></h1>
<dl class="function">
<dt id="coremltools.converters.keras.convert">
<code class="descclassname">coremltools.converters.keras.</code><code class="descname">convert</code><span class="sig-paren">(</span><em>model</em>, <em>input_names=None</em>, <em>output_names=None</em>, <em>image_input_names=None</em>, <em>input_name_shape_dict={}</em>, <em>is_bgr=False</em>, <em>red_bias=0.0</em>, <em>green_bias=0.0</em>, <em>blue_bias=0.0</em>, <em>gray_bias=0.0</em>, <em>image_scale=1.0</em>, <em>class_labels=None</em>, <em>predicted_feature_name=None</em>, <em>model_precision='float32'</em>, <em>predicted_probabilities_output=''</em>, <em>add_custom_layers=False</em>, <em>custom_conversion_functions=None</em>, <em>input_shapes=None</em>, <em>output_shapes=None</em>, <em>respect_trainable=False</em>, <em>use_float_arraytype=False</em><span class="sig-paren">)</span><a class="headerlink" href="#coremltools.converters.keras.convert" title="Permalink to this definition">¶</a></dt>
<dd><p>Convert a Keras model to Core ML protobuf specification (.mlmodel).</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><dl class="first docutils">
<dt><strong>model: Keras model object | str | (str, str)</strong></dt>
<dd><p class="first">A trained Keras neural network model which can be one of the following:</p>
<ul class="last simple">
<li>a Keras model object</li>
<li>a string with the path to a Keras model file (h5)</li>
<li>a tuple of strings, where the first is the path to a Keras model</li>
</ul>
</dd>
<dt><strong>architecture (.json file), the second is the path to its weights stored in h5 file.</strong></dt>
<dd></dd>
<dt><strong>input_names: [str] | str</strong></dt>
<dd><p class="first last">Optional name(s) that can be given to the inputs of the Keras model.
These names will be used in the interface of the Core ML models to refer
to the inputs of the Keras model. If not provided, the Keras inputs
are named to [input1, input2, …, inputN] in the Core ML model.  When
multiple inputs are present, the input feature names are in the same
order as the Keras inputs.</p>
</dd>
<dt><strong>output_names: [str] | str</strong></dt>
<dd><p class="first last">Optional name(s) that can be given to the outputs of the Keras model.
These names will be used in the interface of the Core ML models to refer
to the outputs of the Keras model. If not provided, the Keras outputs
are named to [output1, output2, …, outputN] in the Core ML model.
When multiple outputs are present, output feature names are in the same
order as the Keras inputs.</p>
</dd>
<dt><strong>image_input_names: [str] | str</strong></dt>
<dd><p class="first last">Input names to the Keras model (a subset of the input_names
parameter) that can be treated as images by Core ML. All other inputs
are treated as MultiArrays (N-D Arrays).</p>
</dd>
<dt><strong>is_bgr: bool | dict()</strong></dt>
<dd><p class="first last">Flag indicating the channel order the model internally uses to represent
color images. Set to True if the internal channel order is BGR,
otherwise it will be assumed RGB. This flag is applicable only if
image_input_names is specified. To specify a different value for each
image input, provide a dictionary with input names as keys.
Note that this flag is about the models internal channel order.
An input image can be passed to the model in any color pixel layout
containing red, green and blue values (e.g. 32BGRA or 32ARGB). This flag
determines how those pixel values get mapped to the internal multiarray
representation.</p>
</dd>
<dt><strong>red_bias: float | dict()</strong></dt>
<dd><p class="first last">Bias value to be added to the red channel of the input image.
Defaults to 0.0
Applicable only if image_input_names is specified.
To specify different values for each image input provide a dictionary with input names as keys.</p>
</dd>
<dt><strong>blue_bias: float | dict()</strong></dt>
<dd><p class="first last">Bias value to be added to the blue channel of the input image.
Defaults to 0.0
Applicable only if image_input_names is specified.
To specify different values for each image input provide a dictionary with input names as keys.</p>
</dd>
<dt><strong>green_bias: float | dict()</strong></dt>
<dd><p class="first last">Bias value to be added to the green channel of the input image.
Defaults to 0.0
Applicable only if image_input_names is specified.
To specify different values for each image input provide a dictionary with input names as keys.</p>
</dd>
<dt><strong>gray_bias: float | dict()</strong></dt>
<dd><p class="first last">Bias value to be added to the input image (in grayscale). Defaults
to 0.0
Applicable only if image_input_names is specified.
To specify different values for each image input provide a dictionary with input names as keys.</p>
</dd>
<dt><strong>image_scale: float | dict()</strong></dt>
<dd><p class="first last">Value by which input images will be scaled before bias is added and
Core ML model makes a prediction. Defaults to 1.0.
Applicable only if image_input_names is specified.
To specify different values for each image input provide a dictionary with input names as keys.</p>
</dd>
<dt><strong>class_labels: list[int or str] | str</strong></dt>
<dd><p class="first">Class labels (applies to classifiers only) that map the index of the
output of a neural network to labels in a classifier.</p>
<p class="last">If the provided class_labels is a string, it is assumed to be a
filepath where classes are parsed as a list of newline separated
strings.</p>
</dd>
<dt><strong>predicted_feature_name: str</strong></dt>
<dd><p class="first last">Name of the output feature for the class labels exposed in the Core ML
model (applies to classifiers only). Defaults to ‘classLabel’</p>
</dd>
<dt><strong>model_precision: str</strong></dt>
<dd><p class="first last">Precision at which model will be saved. Currently full precision (float) and half precision
(float16) models are supported. Defaults to ‘_MLMODEL_FULL_PRECISION’ (full precision).</p>
</dd>
<dt><strong>predicted_probabilities_output: str</strong></dt>
<dd><p class="first last">Name of the neural network output to be interpreted as the predicted
probabilities of the resulting classes. Typically the output of a
softmax function. Defaults to the first output blob.</p>
</dd>
<dt><strong>add_custom_layers: bool</strong></dt>
<dd><p class="first last">If yes, then unknown Keras layer types will be added to the model as
‘custom’ layers, which must then be filled in as postprocessing.</p>
</dd>
<dt><strong>custom_conversion_functions: {str:(Layer -&gt; (dict, [weights])) }</strong></dt>
<dd><p class="first last">A dictionary with keys corresponding to names of custom layers and values
as functions taking a Keras custom layer and returning a parameter dictionary
and list of weights.</p>
</dd>
<dt><strong>respect_trainable: bool</strong></dt>
<dd><p class="first last">If yes, then Keras layers marked ‘trainable’ will automatically be
marked updatable in the Core ML model.</p>
</dd>
<dt><strong>use_float_arraytype: bool</strong></dt>
<dd><p class="first last">If true, the datatype of input/output multiarrays is set to Float32 instead
of double.</p>
</dd>
</dl>
</td>
</tr>
<tr class="field-even field"><th class="field-name">Returns:</th><td class="field-body"><dl class="first last docutils">
<dt>model: MLModel</dt>
<dd></dd>
<dt>Model in Core ML format.</dt>
<dd></dd>
</dl>
</td>
</tr>
</tbody>
</table>
<p class="rubric">Examples</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># Make a Keras model</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">model</span> <span class="o">=</span> <span class="n">Sequential</span><span class="p">()</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">model</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">Dense</span><span class="p">(</span><span class="n">num_channels</span><span class="p">,</span> <span class="n">input_dim</span> <span class="o">=</span> <span class="n">input_dim</span><span class="p">))</span>

<span class="c1"># Convert it with default input and output names</span>
<span class="o">&gt;&gt;&gt;</span> <span class="kn">import</span> <span class="nn">coremltools</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">coreml_model</span> <span class="o">=</span> <span class="n">coremltools</span><span class="o">.</span><span class="n">converters</span><span class="o">.</span><span class="n">keras</span><span class="o">.</span><span class="n">convert</span><span class="p">(</span><span class="n">model</span><span class="p">)</span>

<span class="c1"># Saving the Core ML model to a file.</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">coreml_model</span><span class="o">.</span><span class="n">save</span><span class="p">(</span><span class="s1">&#39;my_model.mlmodel&#39;</span><span class="p">)</span>
</pre></div>
</div>
<p>Converting a model with a single image input.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">coreml_model</span> <span class="o">=</span> <span class="n">coremltools</span><span class="o">.</span><span class="n">converters</span><span class="o">.</span><span class="n">keras</span><span class="o">.</span><span class="n">convert</span><span class="p">(</span><span class="n">model</span><span class="p">,</span> <span class="n">input_names</span> <span class="o">=</span>
<span class="gp">... </span><span class="s1">&#39;image&#39;</span><span class="p">,</span> <span class="n">image_input_names</span> <span class="o">=</span> <span class="s1">&#39;image&#39;</span><span class="p">)</span>
</pre></div>
</div>
<p>Core ML also lets you add class labels to models to expose them as
classifiers.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">coreml_model</span> <span class="o">=</span> <span class="n">coremltools</span><span class="o">.</span><span class="n">converters</span><span class="o">.</span><span class="n">keras</span><span class="o">.</span><span class="n">convert</span><span class="p">(</span><span class="n">model</span><span class="p">,</span> <span class="n">input_names</span> <span class="o">=</span> <span class="s1">&#39;image&#39;</span><span class="p">,</span>
<span class="gp">... </span><span class="n">image_input_names</span> <span class="o">=</span> <span class="s1">&#39;image&#39;</span><span class="p">,</span> <span class="n">class_labels</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;cat&#39;</span><span class="p">,</span> <span class="s1">&#39;dog&#39;</span><span class="p">,</span> <span class="s1">&#39;rat&#39;</span><span class="p">])</span>
</pre></div>
</div>
<p>Class labels for classifiers can also come from a file on disk.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">coreml_model</span> <span class="o">=</span> <span class="n">coremltools</span><span class="o">.</span><span class="n">converters</span><span class="o">.</span><span class="n">keras</span><span class="o">.</span><span class="n">convert</span><span class="p">(</span><span class="n">model</span><span class="p">,</span> <span class="n">input_names</span> <span class="o">=</span>
<span class="gp">... </span><span class="s1">&#39;image&#39;</span><span class="p">,</span> <span class="n">image_input_names</span> <span class="o">=</span> <span class="s1">&#39;image&#39;</span><span class="p">,</span> <span class="n">class_labels</span> <span class="o">=</span> <span class="s1">&#39;labels.txt&#39;</span><span class="p">)</span>
</pre></div>
</div>
<p>Provide customized input and output names to the Keras inputs and outputs
while exposing them to Core ML.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">coreml_model</span> <span class="o">=</span> <span class="n">coremltools</span><span class="o">.</span><span class="n">converters</span><span class="o">.</span><span class="n">keras</span><span class="o">.</span><span class="n">convert</span><span class="p">(</span><span class="n">model</span><span class="p">,</span> <span class="n">input_names</span> <span class="o">=</span>
<span class="gp">... </span>  <span class="p">[</span><span class="s1">&#39;my_input_1&#39;</span><span class="p">,</span> <span class="s1">&#39;my_input_2&#39;</span><span class="p">],</span> <span class="n">output_names</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;my_output&#39;</span><span class="p">])</span>
</pre></div>
</div>
</dd></dl>

</div>


           </div>
           
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="coremltools.converters.caffe.convert.html" class="btn btn-neutral float-right" title="coremltools.converters.caffe.convert" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="coremltools.converters.tensorflow.convert.html" class="btn btn-neutral float-left" title="coremltools.converters.tensorflow.convert" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2017-2019, Apple Inc

    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/rtfd/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  


  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
   

</body>
</html>