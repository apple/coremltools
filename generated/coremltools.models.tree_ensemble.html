

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>coremltools.models.tree_ensemble &mdash; coremltools 3.1 documentation</title>
  

  
  
  
  

  
  <script type="text/javascript" src="../static/js/modernizr.min.js"></script>
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="../" src="../static/documentation_options.js"></script>
        <script type="text/javascript" src="../static/jquery.js"></script>
        <script type="text/javascript" src="../static/underscore.js"></script>
        <script type="text/javascript" src="../static/doctools.js"></script>
        <script type="text/javascript" src="../static/language_data.js"></script>
        <script async="async" type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/latest.js?config=TeX-AMS-MML_HTMLorMML"></script>
    
    <script type="text/javascript" src="../static/js/theme.js"></script>

    

  
  <link rel="stylesheet" href="../static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../static/pygments.css" type="text/css" />
  <link rel="stylesheet" href="../static/graphviz.css" type="text/css" />
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="coremltools.models.nearest_neighbors.builder" href="coremltools.models.nearest_neighbors.builder.html" />
    <link rel="prev" title="coremltools.models.pipeline" href="coremltools.models.pipeline.html" />
    <link href="../static/style.css" rel="stylesheet" type="text/css">

</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search"  style="background: #007AFF" >
          

          
            <a href="../index.html" class="icon icon-home"> coremltools
          

          
          </a>

          
            
            
              <div class="version">
                3.1
              </div>
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../coremltools.converters.html">Converters</a><ul>
<li class="toctree-l2"><a class="reference internal" href="coremltools.converters.tensorflow.convert.html">coremltools.converters.tensorflow.convert</a></li>
<li class="toctree-l2"><a class="reference internal" href="coremltools.converters.keras.convert.html">coremltools.converters.keras.convert</a></li>
<li class="toctree-l2"><a class="reference internal" href="coremltools.converters.caffe.convert.html">coremltools.converters.caffe.convert</a></li>
<li class="toctree-l2"><a class="reference internal" href="coremltools.converters.libsvm.convert.html">coremltools.converters.libsvm.convert</a></li>
<li class="toctree-l2"><a class="reference internal" href="coremltools.converters.sklearn.convert.html">coremltools.converters.sklearn.convert</a></li>
<li class="toctree-l2"><a class="reference internal" href="coremltools.converters.xgboost.convert.html">coremltools.converters.xgboost.convert</a></li>
</ul>
</li>
<li class="toctree-l1 current"><a class="reference internal" href="../coremltools.models.html">Models</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="coremltools.models.MLModel.html">coremltools.models.MLModel</a></li>
<li class="toctree-l2"><a class="reference internal" href="coremltools.models.pipeline.html">coremltools.models.pipeline</a></li>
<li class="toctree-l2 current"><a class="current reference internal" href="#">coremltools.models.tree_ensemble</a></li>
<li class="toctree-l2"><a class="reference internal" href="coremltools.models.nearest_neighbors.builder.html">coremltools.models.nearest_neighbors.builder</a></li>
<li class="toctree-l2"><a class="reference internal" href="coremltools.models.neural_network.builder.html">coremltools.models.neural_network.builder</a></li>
<li class="toctree-l2"><a class="reference internal" href="coremltools.models.neural_network.flexible_shape_utils.html">coremltools.models.neural_network.flexible_shape_utils</a></li>
<li class="toctree-l2"><a class="reference internal" href="coremltools.models.neural_network.quantization_utils.html">coremltools.models.neural_network.quantization_utils</a></li>
<li class="toctree-l2"><a class="reference internal" href="coremltools.models.neural_network.update_optimizer_utils.html">coremltools.models.neural_network.update_optimizer_utils</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../coremltools.utils.html">Utilities</a><ul class="simple">
</ul>
</li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">coremltools</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content style-external-links">
        
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../index.html">Docs</a> &raquo;</li>
        
          <li><a href="../coremltools.models.html">Models</a> &raquo;</li>
        
      <li>coremltools.models.tree_ensemble</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
            
            <a href="../sources/generated/coremltools.models.tree_ensemble.rst.txt" rel="nofollow"> View page source</a>
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="module-coremltools.models.tree_ensemble">
<span id="coremltools-models-tree-ensemble"></span><h1>coremltools.models.tree_ensemble<a class="headerlink" href="#module-coremltools.models.tree_ensemble" title="Permalink to this headline">¶</a></h1>
<p>Tree ensemble builder class to construct CoreML models.</p>
<p class="rubric">Classes</p>
<table border="1" class="longtable docutils">
<colgroup>
<col width="10%" />
<col width="90%" />
</colgroup>
<tbody valign="top">
<tr class="row-odd"><td><a class="reference internal" href="#coremltools.models.tree_ensemble.TreeEnsembleBase" title="coremltools.models.tree_ensemble.TreeEnsembleBase"><code class="xref py py-obj docutils literal notranslate"><span class="pre">TreeEnsembleBase</span></code></a>()</td>
<td>Base class for the tree ensemble builder class.</td>
</tr>
<tr class="row-even"><td><a class="reference internal" href="#coremltools.models.tree_ensemble.TreeEnsembleClassifier" title="coremltools.models.tree_ensemble.TreeEnsembleClassifier"><code class="xref py py-obj docutils literal notranslate"><span class="pre">TreeEnsembleClassifier</span></code></a>(features,&nbsp;…)</td>
<td>Tree Ensemble builder class to construct a Tree Ensemble classification model.</td>
</tr>
<tr class="row-odd"><td><a class="reference internal" href="#coremltools.models.tree_ensemble.TreeEnsembleRegressor" title="coremltools.models.tree_ensemble.TreeEnsembleRegressor"><code class="xref py py-obj docutils literal notranslate"><span class="pre">TreeEnsembleRegressor</span></code></a>(features,&nbsp;target)</td>
<td>Tree Ensemble builder class to construct a Tree Ensemble regression model.</td>
</tr>
</tbody>
</table>
<dl class="class">
<dt id="coremltools.models.tree_ensemble.TreeEnsembleBase">
<em class="property">class </em><code class="descclassname">coremltools.models.tree_ensemble.</code><code class="descname">TreeEnsembleBase</code><a class="headerlink" href="#coremltools.models.tree_ensemble.TreeEnsembleBase" title="Permalink to this definition">¶</a></dt>
<dd><p>Base class for the tree ensemble builder class.  This should be instantiated
either through the <a class="reference internal" href="#coremltools.models.tree_ensemble.TreeEnsembleRegressor" title="coremltools.models.tree_ensemble.TreeEnsembleRegressor"><code class="xref py py-class docutils literal notranslate"><span class="pre">TreeEnsembleRegressor</span></code></a> or 
<a class="reference internal" href="#coremltools.models.tree_ensemble.TreeEnsembleClassifier" title="coremltools.models.tree_ensemble.TreeEnsembleClassifier"><code class="xref py py-class docutils literal notranslate"><span class="pre">TreeEnsembleClassifier</span></code></a> classes.</p>
<dl class="method">
<dt id="coremltools.models.tree_ensemble.TreeEnsembleBase.__init__">
<code class="descname">__init__</code><span class="sig-paren">(</span><em>self</em><span class="sig-paren">)</span><a class="headerlink" href="#coremltools.models.tree_ensemble.TreeEnsembleBase.__init__" title="Permalink to this definition">¶</a></dt>
<dd><p>High level Python API to build a tree ensemble model for Core ML.</p>
</dd></dl>

<dl class="method">
<dt id="coremltools.models.tree_ensemble.TreeEnsembleBase.add_branch_node">
<code class="descname">add_branch_node</code><span class="sig-paren">(</span><em>self</em>, <em>tree_id</em>, <em>node_id</em>, <em>feature_index</em>, <em>feature_value</em>, <em>branch_mode</em>, <em>true_child_id</em>, <em>false_child_id</em>, <em>relative_hit_rate=None</em>, <em>missing_value_tracks_true_child=False</em><span class="sig-paren">)</span><a class="headerlink" href="#coremltools.models.tree_ensemble.TreeEnsembleBase.add_branch_node" title="Permalink to this definition">¶</a></dt>
<dd><p>Add a branch node to the tree ensemble.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><dl class="first last docutils">
<dt><strong>tree_id: int</strong></dt>
<dd><p class="first last">ID of the tree to add the node to.</p>
</dd>
<dt><strong>node_id: int</strong></dt>
<dd><p class="first last">ID of the node within the tree.</p>
</dd>
<dt><strong>feature_index: int</strong></dt>
<dd><p class="first last">Index of the feature in the input being split on.</p>
</dd>
<dt><strong>feature_value: double or int</strong></dt>
<dd><p class="first last">The value used in the feature comparison determining the traversal 
direction from this node.</p>
</dd>
<dt><strong>branch_mode: str</strong></dt>
<dd><p class="first">Branch mode of the node, specifying the condition under which the node 
referenced by <cite>true_child_id</cite> is called next.</p>
<p>Must be one of the following:</p>
<blockquote class="last">
<div><ul class="simple">
<li><cite>“BranchOnValueLessThanEqual”</cite>. Traverse to node <cite>true_child_id</cite>
if <cite>input[feature_index] &lt;= feature_value</cite>, and <cite>false_child_id</cite> 
otherwise.</li>
<li><cite>“BranchOnValueLessThan”</cite>. Traverse to node <cite>true_child_id</cite>
if <cite>input[feature_index] &lt; feature_value</cite>, and <cite>false_child_id</cite> 
otherwise.</li>
<li><cite>“BranchOnValueGreaterThanEqual”</cite>. Traverse to node <cite>true_child_id</cite>
if <cite>input[feature_index] &gt;= feature_value</cite>, and <cite>false_child_id</cite> 
otherwise.</li>
<li><cite>“BranchOnValueGreaterThan”</cite>. Traverse to node <cite>true_child_id</cite>
if <cite>input[feature_index] &gt; feature_value</cite>, and <cite>false_child_id</cite> 
otherwise.</li>
<li><cite>“BranchOnValueEqual”</cite>. Traverse to node <cite>true_child_id</cite>
if <cite>input[feature_index] == feature_value</cite>, and <cite>false_child_id</cite> 
otherwise.</li>
<li><cite>“BranchOnValueNotEqual”</cite>. Traverse to node <cite>true_child_id</cite>
if <cite>input[feature_index] != feature_value</cite>, and <cite>false_child_id</cite> 
otherwise.</li>
</ul>
</div></blockquote>
</dd>
<dt><strong>true_child_id: int</strong></dt>
<dd><p class="first last">ID of the child under the true condition of the split.  An error will
be raised at model validation if this does not match the <cite>node_id</cite>
of a node instantiated by <cite>add_branch_node</cite> or <cite>add_leaf_node</cite> within
this <cite>tree_id</cite>.</p>
</dd>
<dt><strong>false_child_id: int</strong></dt>
<dd><p class="first last">ID of the child under the false condition of the split.  An error will
be raised at model validation if this does not match the <cite>node_id</cite>
of a node instantiated by <cite>add_branch_node</cite> or <cite>add_leaf_node</cite> within
this <cite>tree_id</cite>.</p>
</dd>
<dt><strong>relative_hit_rate: float [optional]</strong></dt>
<dd><p class="first last">When the model is converted compiled by CoreML, this gives hints to 
Core ML about which node is more likely to be hit on evaluation, 
allowing for additional optimizations. The values can be on any scale, 
with the values between child nodes being compared relative to each 
other.</p>
</dd>
<dt><strong>missing_value_tracks_true_child: bool [optional]</strong></dt>
<dd><p class="first last">If the training data contains NaN values or missing values, then this
flag determines which direction a NaN value traverses.</p>
</dd>
</dl>
</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="method">
<dt id="coremltools.models.tree_ensemble.TreeEnsembleBase.add_leaf_node">
<code class="descname">add_leaf_node</code><span class="sig-paren">(</span><em>self</em>, <em>tree_id</em>, <em>node_id</em>, <em>values</em>, <em>relative_hit_rate=None</em><span class="sig-paren">)</span><a class="headerlink" href="#coremltools.models.tree_ensemble.TreeEnsembleBase.add_leaf_node" title="Permalink to this definition">¶</a></dt>
<dd><p>Add a leaf node to the tree ensemble.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><dl class="first last docutils">
<dt><strong>tree_id: int</strong></dt>
<dd><p class="first last">ID of the tree to add the node to.</p>
</dd>
<dt><strong>node_id: int</strong></dt>
<dd><p class="first last">ID of the node within the tree.</p>
</dd>
<dt><strong>values: [float | int | list | dict]</strong></dt>
<dd><p class="first">Value(s) at the leaf node to add to the prediction when this node is 
activated.  If the prediction dimension of the tree is 1, then the 
value is specified as a float or integer value.</p>
<p>For multidimensional predictions, the values can be a list of numbers 
with length matching the dimension of the predictions or a dictionary
mapping index to value added to that dimension.</p>
<p class="last">Note that the dimension of any tree must match the dimension given
when <a class="reference internal" href="#coremltools.models.tree_ensemble.TreeEnsembleBase.set_default_prediction_value" title="coremltools.models.tree_ensemble.TreeEnsembleBase.set_default_prediction_value"><code class="xref py py-meth docutils literal notranslate"><span class="pre">set_default_prediction_value()</span></code></a> is called.</p>
</dd>
</dl>
</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="method">
<dt id="coremltools.models.tree_ensemble.TreeEnsembleBase.set_default_prediction_value">
<code class="descname">set_default_prediction_value</code><span class="sig-paren">(</span><em>self</em>, <em>values</em><span class="sig-paren">)</span><a class="headerlink" href="#coremltools.models.tree_ensemble.TreeEnsembleBase.set_default_prediction_value" title="Permalink to this definition">¶</a></dt>
<dd><p>Set the default prediction value(s).</p>
<p>The values given here form the base prediction value that the values 
at activated leaves are added to.  If values is a scalar, then 
the output of the tree must also be 1 dimensional; otherwise, values
must be a list with length matching the dimension of values in the tree.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><dl class="first last docutils">
<dt><strong>values: [int | double | list[double]]</strong></dt>
<dd><p class="first last">Default values for predictions.</p>
</dd>
</dl>
</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="method">
<dt id="coremltools.models.tree_ensemble.TreeEnsembleBase.set_post_evaluation_transform">
<code class="descname">set_post_evaluation_transform</code><span class="sig-paren">(</span><em>self</em>, <em>value</em><span class="sig-paren">)</span><a class="headerlink" href="#coremltools.models.tree_ensemble.TreeEnsembleBase.set_post_evaluation_transform" title="Permalink to this definition">¶</a></dt>
<dd><p>Set the post processing transform applied after the prediction value 
from the tree ensemble.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><dl class="first last docutils">
<dt><strong>value: str</strong></dt>
<dd><p class="first">A value denoting the transform applied.  Possible values are:</p>
<ul class="last">
<li><p class="first">“NoTransform” (default).  Do not apply a transform.</p>
</li>
<li><p class="first">“Classification_SoftMax”.</p>
<p>Apply a softmax function to the outcome to produce normalized, 
non-negative scores that sum to 1.  The transformation applied to
dimension <cite>i</cite> is equivalent to:</p>
<blockquote>
<div><div class="math notranslate nohighlight">
\[\frac{e^{x_i}}{\sum_j e^{x_j}}\]</div>
</div></blockquote>
<p>Note: This is the output transformation applied by the XGBoost package 
with multiclass classification.</p>
</li>
<li><p class="first">“Regression_Logistic”.</p>
<p>Applies a logistic transform the predicted value, specifically:</p>
<blockquote>
<div><div class="math notranslate nohighlight">
\[(1 + e^{-v})^{-1}\]</div>
</div></blockquote>
<p>This is the transformation used in binary classification.</p>
</li>
</ul>
</dd>
</dl>
</td>
</tr>
</tbody>
</table>
</dd></dl>

</dd></dl>

<dl class="class">
<dt id="coremltools.models.tree_ensemble.TreeEnsembleClassifier">
<em class="property">class </em><code class="descclassname">coremltools.models.tree_ensemble.</code><code class="descname">TreeEnsembleClassifier</code><span class="sig-paren">(</span><em>features</em>, <em>class_labels</em>, <em>output_features</em><span class="sig-paren">)</span><a class="headerlink" href="#coremltools.models.tree_ensemble.TreeEnsembleClassifier" title="Permalink to this definition">¶</a></dt>
<dd><p>Tree Ensemble builder class to construct a Tree Ensemble classification model.</p>
<p>The TreeEnsembleClassifier class constructs a Tree Ensemble model incrementally
using methods to add branch and leaf nodes specifying the behavior of the model.</p>
<p class="rubric">Examples</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">input_features</span> <span class="o">=</span> <span class="p">[(</span><span class="s2">&quot;a&quot;</span><span class="p">,</span> <span class="n">datatypes</span><span class="o">.</span><span class="n">Array</span><span class="p">(</span><span class="mi">3</span><span class="p">)),</span> <span class="p">(</span><span class="s2">&quot;b&quot;</span><span class="p">,</span> <span class="n">datatypes</span><span class="o">.</span><span class="n">Double</span><span class="p">())]</span>

<span class="gp">&gt;&gt;&gt; </span><span class="n">tm</span> <span class="o">=</span> <span class="n">TreeEnsembleClassifier</span><span class="p">(</span><span class="n">features</span> <span class="o">=</span> <span class="n">input_features</span><span class="p">,</span> <span class="n">class_labels</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">],</span> 
<span class="go">                                output_features = &quot;predicted_class&quot;)</span>

<span class="gp">&gt;&gt;&gt; </span><span class="c1"># Split on a[2] &lt;= 3</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">tm</span><span class="o">.</span><span class="n">add_branch_node</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="s2">&quot;BranchOnValueLessThanEqual&quot;</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>

<span class="gp">&gt;&gt;&gt; </span><span class="c1"># Add leaf to the true branch of node 0 that subtracts 1.</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">tm</span><span class="o">.</span><span class="n">add_leaf_node</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">)</span>

<span class="gp">&gt;&gt;&gt; </span><span class="c1"># Add split on b == 0 to the false branch of node 0. </span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">tm</span><span class="o">.</span><span class="n">add_branch_node</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="s2">&quot;BranchOnValueEqual&quot;</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">)</span>

<span class="gp">&gt;&gt;&gt; </span><span class="c1"># Add leaf to the true branch of node 2 that adds 1 to the result.</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">tm</span><span class="o">.</span><span class="n">add_leaf_node</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>

<span class="gp">&gt;&gt;&gt; </span><span class="c1"># Add leaf to the false branch of node 2 that subtracts 1 from the result.</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">tm</span><span class="o">.</span><span class="n">add_leaf_node</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">)</span>

<span class="gp">&gt;&gt;&gt; </span><span class="c1"># Put in a softmax transform to translate these into probabilities. </span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">tm</span><span class="o">.</span><span class="n">set_post_evaluation_transform</span><span class="p">(</span><span class="s2">&quot;Classification_SoftMax&quot;</span><span class="p">)</span>

<span class="gp">&gt;&gt;&gt; </span><span class="n">tm</span><span class="o">.</span><span class="n">set_default_prediction_value</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">])</span>

<span class="gp">&gt;&gt;&gt; </span><span class="c1"># save the model to a .mlmodel file</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">model_path</span> <span class="o">=</span> <span class="s1">&#39;./tree.mlmodel&#39;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">coremltools</span><span class="o">.</span><span class="n">models</span><span class="o">.</span><span class="n">utils</span><span class="o">.</span><span class="n">save_spec</span><span class="p">(</span><span class="n">tm</span><span class="o">.</span><span class="n">spec</span><span class="p">,</span> <span class="n">model_path</span><span class="p">)</span>

<span class="gp">&gt;&gt;&gt; </span><span class="c1"># load the .mlmodel</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">mlmodel</span> <span class="o">=</span> <span class="n">coremltools</span><span class="o">.</span><span class="n">models</span><span class="o">.</span><span class="n">MLModel</span><span class="p">(</span><span class="n">model_path</span><span class="p">)</span>

<span class="gp">&gt;&gt;&gt; </span><span class="c1"># make predictions</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">test_input</span> <span class="o">=</span> <span class="p">{</span>
<span class="gp">&gt;&gt;&gt; </span>    <span class="s1">&#39;a&#39;</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">])</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">float32</span><span class="p">),</span>
<span class="gp">&gt;&gt;&gt; </span>    <span class="s2">&quot;b&quot;</span><span class="p">:</span> <span class="mf">3.0</span><span class="p">,</span>
<span class="gp">&gt;&gt;&gt; </span><span class="p">}</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">predictions</span> <span class="o">=</span> <span class="n">mlmodel</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">test_input</span><span class="p">)</span>
</pre></div>
</div>
<dl class="method">
<dt id="coremltools.models.tree_ensemble.TreeEnsembleClassifier.__init__">
<code class="descname">__init__</code><span class="sig-paren">(</span><em>self</em>, <em>features</em>, <em>class_labels</em>, <em>output_features</em><span class="sig-paren">)</span><a class="headerlink" href="#coremltools.models.tree_ensemble.TreeEnsembleClassifier.__init__" title="Permalink to this definition">¶</a></dt>
<dd><p>Create a tree ensemble classifier model.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><dl class="first last docutils">
<dt><strong>features: [list of features]</strong></dt>
<dd><p class="first last">Name(s) of the input features, given as a list of <cite>(‘name’, datatype)</cite>
tuples.  The features are one of <code class="xref py py-class docutils literal notranslate"><span class="pre">models.datatypes.Int64</span></code>, 
<code class="xref py py-class docutils literal notranslate"><span class="pre">datatypes.Double</span></code>, or <code class="xref py py-class docutils literal notranslate"><span class="pre">models.datatypes.Array</span></code>.  
Feature indices in the nodes are counted sequentially from 0 through 
the features.</p>
</dd>
<dt><strong>class_labels: [list]</strong></dt>
<dd><p class="first last">A list of string or integer class labels to use in making predictions. 
The length of this must match the dimension of the tree model.</p>
</dd>
<dt><strong>output_features: [list]</strong></dt>
<dd><p class="first last">A string or a list of two strings specifying the names of the two 
output features, the first being a class label corresponding 
to the class with the highest predicted score, and the second being 
a dictionary mapping each class to its score. If <cite>output_features</cite> 
is a string, it specifies the predicted class label and the class 
scores is set to the default value of <cite>“classProbability.”</cite></p>
</dd>
</dl>
</td>
</tr>
</tbody>
</table>
</dd></dl>

</dd></dl>

<dl class="class">
<dt id="coremltools.models.tree_ensemble.TreeEnsembleRegressor">
<em class="property">class </em><code class="descclassname">coremltools.models.tree_ensemble.</code><code class="descname">TreeEnsembleRegressor</code><span class="sig-paren">(</span><em>features</em>, <em>target</em><span class="sig-paren">)</span><a class="headerlink" href="#coremltools.models.tree_ensemble.TreeEnsembleRegressor" title="Permalink to this definition">¶</a></dt>
<dd><p>Tree Ensemble builder class to construct a Tree Ensemble regression model.</p>
<p>The TreeEnsembleRegressor class constructs a Tree Ensemble model incrementally
using methods to add branch and leaf nodes specifying the behavior of the model.</p>
<p class="rubric">Examples</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="c1"># Required inputs</span>
<span class="gp">&gt;&gt;&gt; </span><span class="kn">import</span> <span class="nn">coremltools</span>
<span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">coremltools.models</span> <span class="kn">import</span> <span class="n">datatypes</span>
<span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">coremltools.models.tree_ensemble</span> <span class="kn">import</span> <span class="n">TreeEnsembleRegressor</span>
<span class="gp">&gt;&gt;&gt; </span><span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>

<span class="gp">&gt;&gt;&gt; </span><span class="c1"># Define input features</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">input_features</span> <span class="o">=</span> <span class="p">[(</span><span class="s2">&quot;a&quot;</span><span class="p">,</span> <span class="n">datatypes</span><span class="o">.</span><span class="n">Array</span><span class="p">(</span><span class="mi">3</span><span class="p">)),</span> <span class="p">(</span><span class="s2">&quot;b&quot;</span><span class="p">,</span> <span class="p">(</span><span class="n">datatypes</span><span class="o">.</span><span class="n">Double</span><span class="p">()))]</span>

<span class="gp">&gt;&gt;&gt; </span><span class="c1"># Define output_features</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">output_features</span> <span class="o">=</span> <span class="p">[(</span><span class="s2">&quot;predicted_values&quot;</span><span class="p">,</span> <span class="n">datatypes</span><span class="o">.</span><span class="n">Double</span><span class="p">())]</span>

<span class="gp">&gt;&gt;&gt; </span><span class="n">tm</span> <span class="o">=</span> <span class="n">TreeEnsembleRegressor</span><span class="p">(</span><span class="n">features</span> <span class="o">=</span> <span class="n">input_features</span><span class="p">,</span> <span class="n">target</span> <span class="o">=</span> <span class="n">output_features</span><span class="p">)</span>

<span class="gp">&gt;&gt;&gt; </span><span class="c1"># Split on a[2] &lt;= 3</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">tm</span><span class="o">.</span><span class="n">add_branch_node</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="s2">&quot;BranchOnValueLessThanEqual&quot;</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>

<span class="gp">&gt;&gt;&gt; </span><span class="c1"># Add leaf to the true branch of node 0 that subtracts 1.</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">tm</span><span class="o">.</span><span class="n">add_leaf_node</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">)</span>

<span class="gp">&gt;&gt;&gt; </span><span class="c1"># Add split on b == 0 to the false branch of node 0, which is index 3</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">tm</span><span class="o">.</span><span class="n">add_branch_node</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="s2">&quot;BranchOnValueEqual&quot;</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">)</span>

<span class="gp">&gt;&gt;&gt; </span><span class="c1"># Add leaf to the true branch of node 2 that adds 1 to the result.</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">tm</span><span class="o">.</span><span class="n">add_leaf_node</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>

<span class="gp">&gt;&gt;&gt; </span><span class="c1"># Add leaf to the false branch of node 2 that subtracts 1 from the result.</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">tm</span><span class="o">.</span><span class="n">add_leaf_node</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">)</span>

<span class="gp">&gt;&gt;&gt; </span><span class="n">tm</span><span class="o">.</span><span class="n">set_default_prediction_value</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">])</span>

<span class="gp">&gt;&gt;&gt; </span><span class="c1"># save the model to a .mlmodel file</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">model_path</span> <span class="o">=</span> <span class="s1">&#39;./tree.mlmodel&#39;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">coremltools</span><span class="o">.</span><span class="n">models</span><span class="o">.</span><span class="n">utils</span><span class="o">.</span><span class="n">save_spec</span><span class="p">(</span><span class="n">tm</span><span class="o">.</span><span class="n">spec</span><span class="p">,</span> <span class="n">model_path</span><span class="p">)</span>

<span class="gp">&gt;&gt;&gt; </span><span class="c1"># load the .mlmodel</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">mlmodel</span> <span class="o">=</span> <span class="n">coremltools</span><span class="o">.</span><span class="n">models</span><span class="o">.</span><span class="n">MLModel</span><span class="p">(</span><span class="n">model_path</span><span class="p">)</span>

<span class="gp">&gt;&gt;&gt; </span><span class="c1"># make predictions</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">test_input</span> <span class="o">=</span> <span class="p">{</span>
<span class="gp">&gt;&gt;&gt; </span>    <span class="s1">&#39;a&#39;</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">])</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">float32</span><span class="p">),</span>
<span class="gp">&gt;&gt;&gt; </span>    <span class="s2">&quot;b&quot;</span><span class="p">:</span> <span class="mf">3.0</span><span class="p">,</span>
<span class="gp">&gt;&gt;&gt; </span><span class="p">}</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">predictions</span> <span class="o">=</span> <span class="n">mlmodel</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">test_input</span><span class="p">)</span>
</pre></div>
</div>
<dl class="method">
<dt id="coremltools.models.tree_ensemble.TreeEnsembleRegressor.__init__">
<code class="descname">__init__</code><span class="sig-paren">(</span><em>self</em>, <em>features</em>, <em>target</em><span class="sig-paren">)</span><a class="headerlink" href="#coremltools.models.tree_ensemble.TreeEnsembleRegressor.__init__" title="Permalink to this definition">¶</a></dt>
<dd><p>Create a Tree Ensemble regression model that takes one or more input 
features and maps them to an output feature.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><dl class="first last docutils">
<dt><strong>features: [list of features]</strong></dt>
<dd><p class="first last">Name(s) of the input features, given as a list of <cite>(‘name’, datatype)</cite>
tuples.  The features are one of <code class="xref py py-class docutils literal notranslate"><span class="pre">models.datatypes.Int64</span></code>, 
<code class="xref py py-class docutils literal notranslate"><span class="pre">datatypes.Double</span></code>, or <code class="xref py py-class docutils literal notranslate"><span class="pre">models.datatypes.Array</span></code>.  
Feature indices in the nodes are counted sequentially from 0 through 
the features.</p>
</dd>
<dt><strong>target:  (default = None)</strong></dt>
<dd><p class="first last">Name of the target feature predicted.</p>
</dd>
</dl>
</td>
</tr>
</tbody>
</table>
</dd></dl>

</dd></dl>

</div>


           </div>
           
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="coremltools.models.nearest_neighbors.builder.html" class="btn btn-neutral float-right" title="coremltools.models.nearest_neighbors.builder" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="coremltools.models.pipeline.html" class="btn btn-neutral float-left" title="coremltools.models.pipeline" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2017-2019, Apple Inc

    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/rtfd/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  


  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
   

</body>
</html>